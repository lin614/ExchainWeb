<template>
  <page class="page_content-padding sound-content">
    <div class="sound">
      <block>
        <div class="banner">
          <img src="../static/imgs/sound-1.jpg" alt="Exchain 听我说">
        </div>
        <div slot="inner">
          <div class="inner-content">
            <ul>
              <li>
                <h1 class="inner-tit blue">感谢语</h1>
                <div class="cnt thank-you-cnt">
                  <img class="thank-you" src="../static/imgs/sound-say.png" alt="感谢语">
                  <p>Exchain为期两周的种子测试结束，我们收集了用户、媒体、项目方的建议，并作出了改变。未来，我们将更珍视大家的想法，一次次变更好，与用户共建一个真正属于大家的交易所。</p>
                  <p>如果Exchain好，请分享给你的朋友，如果Exchain还有不足，请告诉我们！</p>
                </div>
              </li>

              <li>
                <h1 class="inner-tit green">用户说</h1>
                <div class="cnt">
                  <ul class="big-user-group">
                    <li class="user-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-user1.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>阿轩：</span>我是股市大神，也是币圈小白。新入贵圈厮杀，资讯将是我手中的利器。</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">习惯了传统股票交易App上各类丰富的内容，初来币圈却不知道如何下手。希望能有更多客观的项目相关内容，能够帮助我了解更多的资讯。相信Exchain如果能加入一些小白普及类的知识，能够吸引更多像我这样的新客群进场。</p>
                      </div>
                    </li>

                    <li class="user-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-user2.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>Backpacker：</span>我是币圈老韭菜，圈内浮沉3余载，需要一双看透项目的火眼金睛。</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">现在市场上很多项目评级的内容，如果交易所网站上能有相似的版块，对我们这种热衷炒币的人还是帮助很大的。项目信息披露透明公开很重要，助于用户识别币种、聪明投资。毕竟这个圈子呆的久了，即使被割也希望被割的明明白白。</p>
                      </div>
                    </li>

                    <li class="user-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-user3.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>千儿：</span>从未做过理财又怎样，我站在巨人的肩上。数字货币投资有潜力，坚持自己认为正确的投资决定。</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">没买过股票没买过比特币，第一次上交易所简直一脸蒙圈：（其实小白不需要多么华丽的页面设计，更希望交易所能像电商一样买卖方便、服务周到意见反馈及时，人人都能参与。最最主要的是，降低了我们这类初级小白入门的门槛。学习理财不容易，希望能在Exchain找到我做价值投资的一片天。</p>
                      </div>
                    </li>
                  </ul>

                  <p class="more-advise">更多用户建议：</p>

                  <ul class="other-user-group">
                    <li class="other-user-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-user4.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1">Physico</p>
                        <p class="p2">买卖不够方便，建议可以用进度条，加入比例这样。然后价格建议直接先给出市场价放在那边，方便改和参考。</p>
                      </div>
                    </li>

                    <li class="other-user-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-user5.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1">Aki</p>
                        <p class="p2">合作伙伴要分类，普通用户，还有超级合作伙伴，超级伙伴又分优质有影响力客户，还有普通超级合作伙伴。</p>
                      </div>
                    </li>

                    <li class="other-user-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-user6.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1">图罗波烈</p>
                        <p class="p2">把停机期间本应该分配的ET，平摊加在后面剩余的几天之内。</p>
                      </div>
                    </li>

                    <li class="other-user-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-user7.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1">呵呵</p>
                        <p class="p2">有时候卡了很多订单，居然没有一键撤销。</p>
                      </div>
                    </li>

                    <li class="other-user-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-user8.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1">娇</p>
                        <p class="p2">交易界面中，能不能把“数量”放在“价格”上面？这样更符合用户的操作习惯吧。。。</p>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>

              <li>
                <h1 class="inner-tit orange">媒体说</h1>
                <div class="cnt">
                  <ul class="media-group">
                    <li class="media-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-media1.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>币圈那点儿事儿：</span>关于币圈的一切，你想知道的都在这里。</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">该有的都有，中规中矩，只是这线看着有些别扭...希望还可以继续改进，考虑到时在种子测试期，大币哥是接受了。种子测试期间通过虚拟的交易获得有价值的平台币ET，不禁想起了圈儿里各种的操盘大赛？对于大币哥来说，虽然最后是空欢喜一场，可还是欢喜了因为好像过把瘾之后，还有ET...</p>
                        <p class="p3">ET你值得拥有。Exchain你值得注册。“我的资产”你可以发朋友圈儿...没人拦着哈哈哈！</p>
                        <img class="qrcode" src="../static/imgs/sound-media1-qrcode.jpg" alt="二维码">
                      </div>
                    </li>

                    <li class="media-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-media2.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>链爱狂：</span>区块链资讯千万条，链爱狂只分享最有价值的。</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">能好，速度快。交易送TOKEN，犹如家有矿。</p>
                        <img class="qrcode" src="../static/imgs/sound-media2-qrcode.jpg" alt="二维码">
                      </div>
                    </li>

                    <li class="media-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-media3.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>牛市财经：</span>拥有百万社群的区块链财经</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">Exchain是真正为用户考虑的一家交易所，也对它的ET增值充满期待，但是不知道后期Token能不能够广泛的应用到更多场景中，如BNB可支付手续费等，让更多的用户从中获利。</p>
                        <a class="link" target="_blank" href="http://news.one">news.one</a>
                      </div>
                    </li>

                    <li class="media-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-media4.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>上下财经：</span>传播区块链知识,传递共识认知</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">Exchain交易所的这种合作模式很好的嘛，只是如果将这种合作模式推荐给朋友的话，以文字形式是不是太单调了，小编认为如果做成海报的形式在朋友圈以及社群转发的话，不仅内容丰富饱满，外观看着也会新颖一些嘛。</p>
                        <a class="link" target="_blank" href="http://www.shangxia.net">www.shangxia.net</a>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>


              <li>
                <h1 class="inner-tit red">项目说</h1>
                <div class="cnt">
                  <ul class="media-group">
                    <li class="media-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-project1.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>路印团队：</span>路印协议新一代区块链资产交易协议和交易所。它采用去中心化技术，提供零风险的代币交易所模式，并允许多家交易所通过竞争，对同样的订单进行链外撮合及链上清结算。</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">Exchain 是一个技术能力很强的团队，我们很期待今后能开展更进一步的合作，实现去中心化平台是未来的趋势。</p>
                        <a class="link" target="_blank" href="https://loopring.org">https://loopring.org</a>
                      </div>
                    </li>

                    <li class="media-item clearfix">
                      <img class="fl avator" src="../static/imgs/sound-project2.jpg" alt="头像">
                      <div class="say-cnt">
                        <p class="p1"><span>链爱狂：</span>区块链资讯千万条，链爱狂只分享最有价值的。</p>
                        <p class="p2">与Exchain共建交易所，听我说：</p>
                        <p class="p3">网站界面简洁，风格清爽，交易操作也不复杂，用户体验还是很不错的。期待后期增加OTC、API等更多功能，越来越专业！</p>
                        <a class="link" target="_blank" href="http://waykichain.com">http://waykichain.com</a>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>

            </ul>

            <div class="our-change">
              <p>我们的改变</p>
            </div>

            <ul class="change-group">
              <li class="change-item">
                <p class="tit">交易页面升级</p>
                <p class="list"><span>增加批量撤单功能</span> | <span>百分比下单功能</span> | <span>自定义5条EMA丰富K线图展示</span> | <span>“数量”“价格”位置优化</span> | <span>提速交易撮合…</span></p>
              </li>

              <li class="change-item">
                <p class="tit">合作伙伴活动</p>
                <p class="list"><span>阶梯式USDT & ET激励，邀请越多奖励越大</span> | <span>邀请双方均有奖，合作伙伴与被邀请人共赢！</span></p>
              </li>
            </ul>

            <a class="your-advise" href="" target="_blank">留下你的建议</a>

          </div>
        </div>
      </block>
    </div>
  </page>

</template>

<script>
import page from './components/page'
import block from './components/block'
import crd from './components/crd'
import ax from 'axios'
import config from '../config/config.js'
import cookie from 'js-cookie'
import md5 from 'crypto-md5'
import util from '../libs/util.js'
// import bus from '../bus.js'

export default {
  name: 'login',
  components: { page, block, crd },
  data() {
    return {
      geetOnReady: false,
      loginLoading: false,
      gtserver: '',
      sense: null,
      loginInfo: {
        email: '',
        pwd: ''
      },
      rules: {
        email: [
          {
            validator: (rule, value, callback) => {
              if (!value) {
                callback(this.$t('errorMsg.EMAIL_BLANK'))
              }
              if (value.length > 100) {
                callback(this.$t('errorMsg.EMAIL_LIMIT_LENGTH'))
              }
              if (util.checkEmail(value)) {
                callback()
              } else {
                callback(this.$t('errorMsg.EMAIL_ERR'))
              }
            },
            trigger: 'blur'
          }
        ],
        pwd: [
          {
            validator: (rule, value, callback) => {
              if (!value) {
                callback(this.$t('errorMsg.PWD_BLANK'))
              }
              if (util.checkPwd(value)) {
                callback()
              } else {
                callback(this.$t('errorMsg.PWD_LIMIT'))
              }
            },
            trigger: 'blur'
          }
        ]
      }
    }
  },
  computed: {
    activeLang() {
      return this.$store.state.activeLang
    }
  },
  methods: {
    loginBefore() {
      if (this.loginLoading) {
        return
      }
      this.loginLoading = true
      this.$refs['loginInfo'].validate(valid => {
        if (valid) {
          this.sense.sense();
        } else {
          this.loginLoading = false
        }
      })
    },
    login() {
      if (this.loginLoading) {
        return
      }
      this.loginLoading = true
      var vu = this
      this.$refs['loginInfo'].validate(valid => {
        if (valid) {
          if (vu.geetOnReady) {
            vu.geettest.verify()
          } else {
            vu.loginLoading = false
            vu.$Message.error(vu.$t('errorMsg.GEET_LOAD_ERR_TIP'))
          }
        } else {
          vu.loginLoading = false
        }
      })
    },
    loginFn(params) {
      var vu = this
      
      let captcha_type = '';
      if (this.$t('common.lang') === 'cn') {
        captcha_type = 'dk-login'
      } else {
        captcha_type = 'dk-login-en'
      }

      params.email = vu.loginInfo.email;
      params.password = md5(vu.loginInfo.pwd)
      params.captcha_type = captcha_type

      ax
        .post(
          config.url.user + '/api/user/login',
          params,
          {
            withcredentials: true
          }
        )
        .then(function(res) {
          if (res.status == '200' && res.data.errorCode == 0) {
            sessionStorage.setItem('uid', res.data.result.id)
            sessionStorage.setItem('email', res.data.result.email)
            vu.$store.commit('showUserInfo', {
              email: res.data.result.email,
              mtime: res.data.result.mtime
            })

            if (res.data.result.pn) {
              ax.defaults.headers.post['X-EXCHAIN-PN'] = res.data.result.pn
              let timestamp = Date.parse(new Date()) + (5*60*1000);
              
              let dateStr = new Date(timestamp);
              cookie.set('PN', res.data.result.pn, {
                domain: config.url.domain,
                expires: 0.08
              })
              cookie.set('email', vu.loginInfo.email, {
                domain: config.url.domain,
                expires: 0.08
              })
              cookie.set('uid', res.data.result.id, {
                domain: config.url.domain,
                expires: 0.08
              })
              var Pn = encodeURIComponent(res.data.result.pn)
              sessionStorage.setItem('PN', Pn)
            }

            vu.$router.push('/userCenter')
          } else {
            vu.loginLoading = false
            // vu.geettest.reset()
            apiError(vu, res);
          }
        })
        .catch(function(err) {
          vu.loginLoading = false
          // vu.geettest.reset()
          apiReqError(vu, err);
        })
    },
    
    initGeetest() {
      var vu = this
      let params = null;

      if (this.$t('common.lang') === 'cn') {
        params = {type: 'dk-login'}
      } else {
        params = {type: 'dk-login-en'}
      }
      ax
        .post(config.url.user + '/api/user/initCaptcha', params)
        .then(res => {
          var data = res.data
          // this.initGeetestAction(data);
          this.initSenseAction(data);
        })
        .catch(() => {
          vu.$Message.error(vu.$t('errorMsg.NETWORK_ERROR'));
        })
    },
    initSenseAction (data) {
      let vu = this;
      vu.$initSense({
        id: data.id,
        lang: vu.$t('common.lang') === 'cn' ? 'zh-cn' : 'en',     
        onError:function(err){
            console.log('gt error', err)
        }
      }, sense => {
        vu.sense = sense;
        vu.$refs.loginBefore.$el.addEventListener('click', this.loginBefore);
        sense.setInfos(function () {
          return {
            interactive: 2  //用户场景
          }
        }).onSuccess(function (data) {
          let params = {geetest_challenge: data.challenge}
          vu.loginFn(params)
        }).onClose(function(){
          console.log('close')
          vu.loginLoading = false
        }).onError(function(err){
          console.log(err);
          if(err && err.code === '1001'){
              submit({})
          }
        })
      });
    },
    initGeetestAction (data) {
      vu.gtserver = data.gtserver
      vu.$initGeetest(
        {
          gt: data.gt,
          challenge: data.challenge,
          offline: !data.success,
          new_captcha: true,
          product: 'bind',
          lang: this.activeLang ? (this.activeLang === 'cn') ? 'zh-cn' : this.activeLang : 'zh-cn'
        },
        function(captchaObj) {
          vu.geettest = captchaObj
          captchaObj
            .onReady(function() {
              vu.geetOnReady = true
            })
            .onSuccess(function() {
              var result = this.geettest.getValidate()
              let params = {
                geetest_challenge: result.geetest_challenge,
                geetest_validate: result.geetest_validate,
                geetest_seccode: result.geetest_seccode,
                gtserver: vu.gtserver
              }
              vu.loginFn(params)
            })
            .onError(function() {
              vu.geetOnReady = false
              vu.$Message.error(vu.$t('errorMsg.GEET_INIT_ERR'))
            })
            .onClose(function () {
                vu.loginLoading = false
            })
        }
      )
    },
    onEnter (e) {
      if (e.keyCode === 13) {
        this.login()
      }
    }
  },
  mounted() {
    this.initGeetest()
    var vu = this
    bus.$on('langChange', () => {
      vu.$refs.loginInfo.resetFields()
      vu.$refs.loginBefore.$el.removeEventListener('click', this.loginBefore, false);
      this.initGeetest()
    })
    window.addEventListener('keyup', this.onEnter)
  },
  destroyed () {
    bus.$off('langChange');
    window.removeEventListener('keyup', this.onEnter)
  }
}
</script>

<style lang="less">
@import url(./style/config.less);
  .page_content-padding.sound-content {

    .page_content {
      padding-top: 0px;
      padding-bottom: 30px;
    }
    .banner {
      background: #084794;
      text-align: center;
      img {
        margin: 0 auto;
      }
    }
    .inner-content {
      margin-top: 30px;
      padding: 40px;
      border-radius: 10px;
      background: #fff;
      .inner-tit {
        position: relative;
        font-size: 24px;
        font-weight: 500;
        border-bottom: 1px solid #e8e8e8;
        margin-bottom: 30px;
        padding-bottom: 20px;
        padding-left: 14px;
        &::before {
          content: '';
          position: absolute;
          left: 0;
          width: 100px;
          height: 4px;
          background: red;
          bottom: 0px;
          border-radius: 10px;
        }
        &.blue {
          color: @font-color-blue;
        }
        &.blue::before {
          background: @font-color-blue;
        }
        &.green {
          color: #50b08c;
        }
        &.green::before {
          background: #50b08c;
        }
        &.orange {
          color: #f4c058;
        }
        &.orange::before {
          background: #f4c058;
        }
        &.red {
          color: #e13737;
        }
        &.red::before {
          background: #e13737;
        }
      }
      .cnt {
        position: relative;
      }
      .thank-you-cnt {
        height: 300px;
        padding: 80px 80px 0px 60px;
        p {
          position: relative;
          margin-bottom: 30px;
          font-size: 16px;
          color: #fff;
        }
      }
      .thank-you {
        position: absolute;
        top: 40px;
        left: 0px;
        z-index: 0;
        height: 220px;
      }

      .user-item {
        margin-bottom: 30px;
        border: 1px solid #eaeaea;
        &:nth-child(2n + 1) {
          background: #f5f5f5;
        }
        &:nth-child(2n) {
          background: #fff;
        }
        .avator {
          width: 120px;
          height: 120px;
          margin: 20px;
        }
        .say-cnt {
          padding-top: 30px;
          p {
            line-height: 24px;
          }
          .p1 {
            margin-bottom: 14px;
            font-size: 16px;
            span {
              color: @font-color-blue;
            }
          }
          .p2 {
            margin-bottom: 10px;
            font-size: 16px;
            color: @font-color-blue;
          }
          .p3 {
            padding-right: 20px;
            font-size: 14px;
          }
        }
      }

      .more-advise {
        margin: 60px 0px 10px 0px;
        font-size: 16px;
      }

      .other-user-item {
        margin-bottom: 30px;
        border-bottom: 1px solid #eaeaea;
        &:last-child {
          border-bottom-width: 0px;
        }
        .avator {
          width: 60px;
          height: 60px;
          margin: 20px 20px 20px 0px;
        }
        .say-cnt {
          padding-top: 25px;
          p {
            line-height: 24px;
          }
          .p1 {
            margin-bottom: 5px;
            font-size: 16px;
            color: @font-color-blue;
          }
        }
      }

      .media-group {
        margin-top: -10px;
        .media-item {
          margin-bottom: 20px;
          border-bottom: 1px solid #eaeaea;
          &:last-child {
            border-bottom-width: 0px;
          }
          .avator {
            width: 60px;
            height: 60px;
            margin: 20px 20px 20px 0px;
          }
          .say-cnt {
            margin-left: 80px;
            padding-top: 25px;
            p {
              line-height: 24px;
            }
            .p1 {
              margin-bottom: 8px;
              font-size: 16px;
              span {
                color: @font-color-blue;
              }
            }
            .p2 {
              margin-bottom: 8px;
              font-size: 16px;
              color: @font-color-blue;
            }
            .p3 {
              margin-bottom: 8px;
              padding-right: 20px;
            }
            .link {
              display: inline-block;
              margin-bottom: 30px;
            }
            .qrcode {
              margin: 10px 0px 30px;
            }
          }
        }
      }

      .our-change {
        position: relative;
        width: 300px;
        height: 20px;
        margin: 60px auto 60px;
        line-height: 20px;
        background: #f2f4fe;
        border-radius: 20px;
        p {
          font-size: 36px;
          color: #333;
          font-weight: 200;
          text-align: center;
        }
        &:before {
          content: '';
          position: absolute;
          top: 5px;
          left: 10px;
          width: 10px;
          height: 10px;
          background: #5f74b7;
          border-radius: 50%;
        }
        &:after {
          content: '';
          position: absolute;
          top: 5px;
          right: 10px;
          width: 10px;
          height: 10px;
          background: #5f74b7;
          border-radius: 50%;
        }
      }
      
      .change-group {
        .change-item {
          margin-bottom: 30px;
          padding: 25px;
          border: 1px solid #eaeaea;
          &:nth-child(2n + 1) {
            background: #f5f5f5;
          }
          &:nth-child(2n) {
            background: #fff;
          }
          p.tit {
            margin-bottom: 5px;
            font-size: 18px;
          }
          p.list {
            font-size: 16px;
          }
          span {
            color: @font-color-blue;
          }
        }
      }

      .your-advise {
        display: block;
        height: 80px;
        font-size: 18px;
        line-height: 80px;
        text-align: center;
        color: #fff;
        background: #2d8cf0;
      }
    }
  } 
</style>
